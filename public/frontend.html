<!DOCTYPE html>
<html lang="es">
<head>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval'">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi Gate - Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* NUEVOS ESTILOS PARA AJUSTE DE TAMAÑO */
        body {
            overflow: hidden;
            min-height: 720px;
            max-height: 720px;
        }

        .main-content {
            margin-left: 250px;
            padding: 15px;
            height: calc(100vh - 30px);
            overflow-y: auto;
        }

        .checker-panel {
            background: rgba(20, 20, 30, 0.95);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .status-circle {
            width: 120px;
            height: 120px;
        }

        .results-content {
            height: 300px;
        }

        #generatedCards {
            height: 120px;
        }

        .results-container {
            max-height: calc(100vh - 250px);
        }

        .generator-panel {
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 32px;
        }

        .user-name {
            font-size: 16px;
        }

        .stats-value {
            font-size: 22px;
        }

        .clear-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            float: right;
        }

        .clear-button:hover {
            background-color: #c82333;
        }

        /* ESTILOS ORIGINALES */
        body {
            background-image: url('aleman-background2.jpg');
            background-size: cover;
            background-position: center;
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: rgba(20, 20, 30, 0.95);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
        }

        .user-avatar {
    width: 80px;          /* Aumentado a 80px */
    height: 80px;         /* Aumentado a 80px */
    border-radius: 50%;   
    margin-bottom: 10px;  
    object-fit: cover;    
}

    .user-info {
    text-align: center;
    padding: 15px 0; /* Reducido de 20px */
    border-bottom: 1px solid rgba(255,255,255,0.1);
       }

    .user-name {
    font-size: 16px; /* Reducido de 18px */
    font-weight: bold;
    margin: 3px 0; /* Reducido de 5px */
        }

        .user-type {
            color: #4a90e2;
            font-size: 14px;
        }

        .global-stats {
            padding: 15px 0;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stats-title {
            font-size: 16px;
            color: #888;
        }

        .stats-value {
            font-size: 24px;
            color: #4a90e2;
            font-weight: bold;
        }


                 .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .checker-panel {
            background: rgba(20, 20, 30, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid #4a90e2;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-align: center;
            background: rgba(30, 30, 40, 0.95);
        }

        .status-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.3);
        }

        .status-circle.running {
            border-color: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(0, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
        }

        .stat-label {
            color: #888;
            font-size: 14px;
        }

        .live-value {
            color: #00ff00;
        }

        .dead-value {
            color: #ff0000;
        }

        .results-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .results-panel, .generator-panel {
            background: rgba(20, 20, 30, 0.95);
            border-radius: 12px;
            overflow: hidden;
        }

        .panel-header {
            padding: 15px 20px;
            background: rgba(30, 30, 40, 0.95);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h3 {
            margin: 0;
            color: #4a90e2;
        }

        .results-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            height: 400px;
        }

        .results-column {
            display: flex;
            flex-direction: column;
        }

        .column-header {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border-radius: 6px 6px 0 0;
        }

        .live-header {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }

        .dead-header {
            background: rgba(255, 0, 0, 0.1);
            color: #ff0000;
        }

        .results-list {
            flex: 1;
            overflow-y: auto;
            background: rgba(25, 25, 35, 0.95);
            border-radius: 0 0 6px 6px;
            padding: 10px;
        }

        .generator-content {
            padding: 20px;
        }

        .generator-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-row {
            display: flex;
            gap: 10px;
        }

        .control-input {
            background: rgba(30, 30, 40, 0.95);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            flex: 1;
        }

        .date-select {
            width: 100px;
            flex: none;
        }

        .control-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.4);
        }

        .control-button.generate {
            background: #00ff00;
            color: #000;
        }

        .generator-output {
            margin-top: 20px;
        }

        #generatedCards {
            width: 100%;
            height: 150px;
            background: rgba(30, 30, 40, 0.95);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            resize: none;
            font-family: monospace;
        }

        .output-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end;
        }

        .card-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
        }

        .card-item.live {
            background: #1a472a;
            color: #2ecc71;
            border-left: 3px solid #2ecc71;
            text-align: left;
        }

        .card-item.dead {
            background: #4a1a1a;
            color: #e74c3c;
            border-left: 3px solid #e74c3c;
            text-align: left;
        }
          
        #livesList, #deadsList {
        max-height: 300px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #666 #333;
        } 

        #livesList::-webkit-scrollbar,
        #deadsList::-webkit-scrollbar {
        width: 6px;
        }

        #livesList::-webkit-scrollbar-track,
        #deadsList::-webkit-scrollbar-track {
        background: #333;
        border-radius: 3px;
        }

        #livesList::-webkit-scrollbar-thumb,
        #deadsList::-webkit-scrollbar-thumb {
        background-color: #666;
        border-radius: 3px;
        }
        .contact-links {
       padding: 15px 0;
       display: flex;
       flex-direction: column;
       gap: 10px;
       border-bottom: 1px solid rgba(255,255,255,0.1);
       }

    .contact-link {
    display: block;
    padding: 10px;
    background: rgba(74, 144, 226, 0.1);
    border-radius: 6px;
    color: #4a90e2;
    text-decoration: none;
    text-align: center;
    transition: all 0.3s ease;
    }

   .contact-link:hover {
    background: rgba(74, 144, 226, 0.2);
    transform: translateY(-2px); 
    }
        .gates-status {
    padding: 15px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    }

.gate-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    margin: 5px 0;
    }

.gate-name {
    color: #fff;
    font-size: 14px;
    }

.gate-status {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    background: rgba(46, 204, 113, 0.2);
    color: #2ecc71;
     }

.gate-status.active {
    background: rgba(46, 204, 113, 0.2);
    color: #2ecc71;
     }

.gate-status.inactive {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
      }
.bin-checker-panel {
    padding: 15px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.panel-header {
    padding: 0 15px;
    margin-bottom: 10px;
}

.panel-header h3 {
    color: #4a90e2;
    margin: 0;
    font-size: 14px;
}

.bin-input-container {
    display: flex;
    gap: 8px;
    padding: 0 15px;
    margin-bottom: 10px;
}

.bin-input {
    width: 80px;
    background: rgba(30, 30, 40, 0.95);
    border: 1px solid rgba(255,255,255,0.1);
    color: #fff;
    padding: 6px;
    border-radius: 4px;
    font-family: monospace;
    font-size: 14px;
    text-align: center;
}

.verify-button {
    padding: 6px 12px;
    background: rgba(74, 144, 226, 0.1);
    color: #4a90e2;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
}

.bin-result-box {
    margin: 0 15px;
    background: rgba(30, 30, 40, 0.95);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 4px;
    padding: 10px;
    font-size: 12px;
}
.user-name {
    font-size: 28px;
    font-weight: bold;
    background: linear-gradient(45deg, #00ff00, #00cc00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 
        2px 2px 4px rgba(0, 255, 0, 0.2),
        -2px -2px 4px rgba(0, 0, 0, 0.3);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin: 15px 0;
    padding: 10px;
    border-radius: 10px;
    position: relative;
    transition: all 0.3s ease;
    animation: glow 2s ease-in-out infinite;
}

.user-name::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 50%;
    height: 2px;
    background: linear-gradient(90deg, 
        transparent, 
        #00ff00, 
        transparent
    );
}

.user-name:hover {
    transform: translateY(-2px) scale(1.05);
    filter: brightness(1.2);
}

@keyframes glow {
    0%, 100% {
        filter: drop-shadow(0 0 5px rgba(0, 255, 0, 0.5));
    }
    50% {
        filter: drop-shadow(0 0 15px rgba(0, 255, 0, 0.8));
    }
}
.days-banner-circle {
    width: 200px;
    height: 80px;
    margin: 15px auto;
    border: 3px solid #4a90e2;
    border-radius: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(30, 30, 40, 0.95);
    box-shadow: 0 0 20px rgba(74, 144, 226, 0.3);
    transition: all 0.3s ease; 
      }

.days-banner-circle .days-count {
    font-size: 24px;
    font-weight: bold;
    color: #4a90e2;
    text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
       }

.days-banner-circle .days-label {
    font-size: 14px;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 5px;
      }
.alert-message {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px;
    border-radius: 5px;
    color: white;
    z-index: 9999;
    animation: slideIn 0.3s ease;
}

.alert-message.error {
    background: #ff4444;
}

.alert-message.success {
    background: #00C851;
}

@keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

.result-item {
    padding: 12px;
    margin: 8px 0;
    border-radius: 6px;
    background: rgba(30, 30, 40, 0.95);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.result-item.live {
    border-left: 4px solid #00ff00;
    background: rgba(0, 255, 0, 0.05);
}

.result-item.dead {
    border-left: 4px solid #ff0000;
    background: rgba(255, 0, 0, 0.05);
}

.result-item-content {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.card-info {
    font-family: monospace;
    font-size: 14px;
    font-weight: bold;
}

.time-info {
    font-size: 12px;
    color: #888;
}

.status-info {
    font-size: 13px;
    font-style: italic;
}

.cards-value {
    color: #4a90e2 !important;
}

#killProcess:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(255,0,0,0.3);
    background: linear-gradient(to right, #cc0000, #ff0000);
}

#killProcess:active {
    transform: translateY(1px);
    box-shadow: 0 2px 4px rgba(255,0,0,0.2);
}

 </style>
</head>
<body>
    <div class="sidebar">
        <div class="user-info">
           <img src="./user-avatar.png" alt="Avatar" class="user-avatar">
              <div class="user-name">BIENVENIDO</div>
            <div class="user-type">Usuario Premium</div>
            <a href="/admin" id="adminLink" style="display: none;" class="contact-link">👑 Panel Admin</a>
        </div>
         <div class="contact-links">
            <a href="https://t.me/Soullinux12" class="contact-link" target="_blank">
              Sugerencias y Compras
         </a>
         <a href="https://t.me/alemanChk" class="contact-link" target="_blank">
        Grupo Telegram
    </a>
</div>  
<div class="gates-status">
    <div class="gate-item">
        <span class="gate-name">Elegba Gate</span>
        <span class="gate-status active">Activo</span>
    </div>
    <div class="gate-item">
        <span class="gate-name">Oshun Gate</span>
        <span class="gate-status active">Activo</span>
    </div>
</div>
    <div class="global-stats">
        <div class="stats-title" style="cursor: pointer;" onclick="showLives()">
            Lives Total
            <div class="stats-value" id="totalLivesCount">0</div>
            <small style="color: #4a90e2; font-size: 12px;">(Click para ver historial)</small>
        </div>
    </div>
     <div class="days-banner-circle">
    <div class="days-count">30</div>
    <div class="days-label">DIAS PREMIUM</div>
       </div>
      <div class="bin-checker-panel">
    <div class="panel-header">
        <h3>BIN Checker Pro</h3>
    </div>
    <div class="bin-checker-content">
        <div class="bin-input-container">
            <input type="text" id="binCheckInput" class="bin-input" placeholder="Ingrese BIN">
            <button id="checkBinBtn" class="verify-button">Verificar BIN</button>
        </div>
        <div class="bin-result-box">
            <pre id="binResult">Esperando BIN para verificar</pre>
     </div>
  </div>
</div>
    </div>
    <div class="main-content">
        <div class="checker-panel">
            <div class="status-circle" id="startButton">
                ¡Gate Cargado!
            </div>
            <button id="killProcess" 
                    style="position: absolute; 
                           top: 20px; 
                           left: 20px;  /* Más cerca del botón start */
                           padding: 8px 15px; 
                           background: linear-gradient(to right, #ff0000, #cc0000);
                           color: white; 
                           font-weight: bold;
                           font-size: 14px; 
                           border-radius: 20px;
                           border: 2px solid #ff0000;
                           cursor: pointer;
                           transition: all 0.3s ease;
                           box-shadow: 0 4px 6px rgba(255,0,0,0.2);
                           text-transform: uppercase;
                           letter-spacing: 1px;
                           z-index: 1000;">
                🛑 Kill
            </button>
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-value live-value" id="livesCount">0</div>
                    <div class="stat-label">Lives</div>
                    <div class="stat-label">0 Créditos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value dead-value" id="deadsCount">0</div>
                    <div class="stat-label">Deads</div>
                    <div class="stat-label">0 Créditos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value cards-value" id="cardsCount">0</div>
                    <div class="stat-label">Tarjetas Restantes</div>
                </div>
            </div>
        </div>

        <div class="results-container">
            <div class="results-panel">
                <div class="panel-header">
                    <h3>Resultados</h3>
                    <div class="panel-controls">
                        <select id="gateSelector" class="control-input">
                            <option value="elegbagate">Elegba Gate</option>
                            <option value="oshungate">Oshun Gate</option>
                        </select>
                    </div>
                </div>
                <div class="results-content">
                    <div class="results-column">
                        <div class="column-header live-header">Lives
                            <button class="clear-button" onclick="clearList('livesList')">Limpiar</button>
                        </div>
                        <div id="livesList" class="results-list">
                            <!-- Aquí se agregarán las lives -->
                        </div>
                    </div>
                    <div class="results-column">
                        <div class="column-header dead-header">Deads
                            <button class="clear-button" onclick="clearList('deadsList')">Limpiar</button>
                        </div>
                        <div id="deadsList" class="results-list">
                            <!-- Aquí se agregarán las deads -->
                        </div>
                    </div>
                </div>
            </div>
                        <div class="generator-panel">
                <div class="panel-header">
                    <h3>Generador de Tarjetas</h3>
                </div>
                <div class="generator-content">
                    <div class="generator-controls">
                        <div class="control-row">
                            <select id="cardType" class="control-input">
                                <option value="auto">Auto Detectar</option>
                                <option value="visa">Visa</option>
                                <option value="mastercard">Mastercard</option>
                                <option value="amex">American Express</option>
                            </select>
                            <input type="text" id="binInput" class="control-input" placeholder="BIN (6-16 dígitos o X)" maxlength="16">
                            <input type="number" id="cantidadInput" class="control-input" placeholder="Cantidad" min="1" max="1000">
                        </div>
                        <div class="control-row">
                            <select id="mesSelect" class="control-input date-select">
                                <option value="">Mes</option>
                                <option value="01">01</option>
                                <option value="02">02</option>
                                <option value="03">03</option>
                                <option value="04">04</option>
                                <option value="05">05</option>
                                <option value="06">06</option>
                                <option value="07">07</option>
                                <option value="08">08</option>
                                <option value="09">09</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="yearSelect" class="control-input date-select">
                                <option value="">Año</option>
                                <option value="24">2024</option>
                                <option value="25">2025</option>
                                <option value="26">2026</option>
                                <option value="27">2027</option>
                                <option value="28">2028</option>
                                <option value="29">2029</option>
                                <option value="30">2030</option>
                                <option value="31">2031</option>
                                <option value="32">2032</option> 
                                <option value="33">2033</option>
                            </select>
                            <button id="generateBtn" class="control-button generate">Generar</button>
                        </div>
                    </div>
                    <div class="generator-output">
                        <textarea id="generatedCards" readonly placeholder="Las tarjetas generadas aparecerán aquí..."></textarea>
                        <div class="output-controls">
                            <button id="pasteCards" class="control-button">Pegar</button>
                            <button id="copyCards" class="control-button">Copiar</button>
                            <button id="loadCards" class="control-button">Cargar al Checker</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
// Protección básica
(function() {
    // Deshabilitar clic derecho solo en elementos sensibles
    document.addEventListener('contextmenu', e => {
        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
            e.preventDefault();
        }
    });
})();

// En frontend.html - Mantener la conexión simple
const socket = io({
    transports: ['polling', 'websocket']
});

socket.on('connect', () => {
    console.log('Conectado al servidor');
});

socket.on('disconnect', (reason) => {
    console.log('Desconectado:', reason);
    if (reason !== 'transport error') {
        socket.connect();
    }
});

// Manejar errores de sesión
socket.on('connect_error', (error) => {
    console.log('Error de conexión:', error);
    if (error.message === 'Sesión expirada') {
        window.location.href = '/login.html';
    }
});

// Mantener conexión viva
setInterval(() => {
    if (socket.connected) {
        socket.emit('ping');
    }
}, 25000);

// Agregar esta función al inicio del script
async function cargarInfoUsuario() {
    try {
        const response = await fetch('/api/user-info');
        const data = await response.json();
        
        if (data.success && data.username) {
            const userNameElement = document.querySelector('.user-name');
            if (userNameElement) {
                // Mostrar el nombre en mayúsculas
                userNameElement.textContent = data.username.toUpperCase();
            }
        }
    } catch (error) {
        console.error('Error cargando info del usuario:', error);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    console.log('Inicializando dashboard...');
    
    const startButton = document.getElementById('startButton');
    const generateBtn = document.getElementById('generateBtn');
    const pasteCards = document.getElementById('pasteCards');
    const loadCards = document.getElementById('loadCards');
    const copyCards = document.getElementById('copyCards');
    const gateSelector = document.getElementById('gateSelector');
    const generatedCardsTextarea = document.getElementById('generatedCards');
    
    let checkerRunning = false;
    let processCount = 0;

    // Llamar a la función cuando se carga la página
    cargarInfoUsuario();

    // Manejar el inicio/parada del checker
    if (startButton) {
        startButton.addEventListener('click', async () => {
            const selectedGate = gateSelector.value;
            const statusCircle = document.querySelector('.status-circle');
            
            if (!checkerRunning) {
                try {
                    startButton.disabled = true;
                    statusCircle.textContent = 'Iniciando...';
                    
                    const response = await fetch('/api/start-checker', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ gateType: selectedGate })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        checkerRunning = true;
                        startButton.classList.add('running');
                        startButton.textContent = 'Checker Ejecutándose';
                    } else {
                        alert(data.message);
                        statusCircle.textContent = '¡Gate Cargado!';
                        startButton.textContent = '¡Gate Cargado!';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al iniciar el checker');
                    statusCircle.textContent = '¡Gate Cargado!';
                    startButton.textContent = '¡Gate Cargado!';
                } finally {
                    startButton.disabled = false;
                }
            } else {
                try {
                    startButton.disabled = true;
                    startButton.style.pointerEvents = 'none';
                    startButton.textContent = 'Deteniendo Checker...';
                    statusCircle.textContent = 'Deteniendo Checker...';

                    const response = await fetch('/api/stop-checker', {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        checkerRunning = false;
                        startButton.classList.remove('running');
                        startButton.textContent = '¡Gate Cargado!';
                        statusCircle.textContent = '¡Gate Cargado!';
                        startButton.disabled = false;
                        startButton.style.pointerEvents = 'auto';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al detener el checker');
                } finally {
                    startButton.disabled = false;
                    startButton.style.pointerEvents = 'auto';
                }
            }
        });
    }

    // Manejar la generación de tarjetas
    if (generateBtn) {
        generateBtn.addEventListener('click', async () => {
            generateBtn.disabled = true;
            const bin = document.getElementById('binInput').value.trim();
            const cantidad = parseInt(document.getElementById('cantidadInput').value) || 1;
            const mes = document.getElementById('mesSelect').value;
            const año = document.getElementById('yearSelect').value;

            if (!bin || !/^[0-9Xx]{6,16}$/.test(bin)) {
                alert('Por favor, ingresa un BIN válido (6-16 dígitos o X).');
                generateBtn.disabled = false;
                return;
            }

            try {
                const response = await fetch('/api/generate-cards', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ bin, cantidad, mes, año })
                });
                
                const data = await response.json();
                if (data.success) {
                    generatedCardsTextarea.value = data.cards?.join('\n') || '';
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al generar tarjetas');
            }
            generateBtn.disabled = false;
        });
    }

    // Copiar tarjetas
    if (copyCards) {
        copyCards.addEventListener('click', () => {
            const text = generatedCardsTextarea.value;
            if (text) {
                navigator.clipboard.writeText(text)
                    .then(() => alert('Tarjetas copiadas al portapapeles'))
                    .catch(err => console.error('Error al copiar:', err));
            }
        });
    }

    // Pegar tarjetas
    if (pasteCards) {
        pasteCards.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                generatedCardsTextarea.value = text;
                alert('Tarjetas pegadas exitosamente');
            } catch (error) {
                console.error('Error al pegar las tarjetas:', error);
                alert('Error al pegar las tarjetas');
            }
        });
    }

    // Cargar tarjetas al checker
    if (loadCards) {
        loadCards.addEventListener('click', async () => {
            const cards = generatedCardsTextarea.value;
            
            if (!cards) {
                alert('No hay tarjetas generadas');
                return;
            }

            try {
                const response = await fetch('/api/load-cards', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tarjetas: cards })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('Tarjetas cargadas exitosamente');
                    const cardsCount = document.getElementById('cardsCount');
                    if (cardsCount) {
                        cardsCount.textContent = cards.split('\n').filter(line => line.trim()).length;
                    }
                } else {
                    alert(data.message || 'Error al cargar las tarjetas');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar las tarjetas');
            }
        });
    }

    // Funciones auxiliares
    function clearList(listId) {
        const listElement = document.getElementById(listId);
        if (listElement) {
            listElement.innerHTML = '';
            const countElement = document.getElementById(`${listId === 'livesList' ? 'lives' : 'deads'}Count`);
            if (countElement) countElement.textContent = '0';
        }
    }

    function updateProcessCount() {
        const processCounter = document.getElementById('processCount');
        if (processCounter) {
            processCount++;
            processCounter.textContent = processCount;
        }
    }

    function addCardToList(data) {
        const listElement = document.getElementById(`${data.tipo}sList`);
        if (!listElement) return;

        const cardItem = document.createElement('div');
        cardItem.className = `card-item ${data.tipo}`;
        
        // Obtener el gate seleccionado
        const gateSelector = document.getElementById('gateSelector');
        const gateName = gateSelector.value === 'elegbagate' ? 'ElegbaGate' : 'OshunGate';
        
        // Formatear el mensaje
        if (data.tipo === 'live') {
            cardItem.textContent = `✨ LIVE ${gateName} - ${data.mensaje_completo}`;
        } else {
            cardItem.textContent = `❌ DEAD ${gateName} - ${data.mensaje_completo}`;
        }

        listElement.insertBefore(cardItem, listElement.firstChild);
        listElement.scrollTop = 0;

        if (listElement.children.length > 100) {
            listElement.removeChild(listElement.lastChild);
        }

        if (data.tipo === 'live') {
            const sound = document.getElementById('liveSound');
            if (sound) {
                sound.currentTime = 0;
                sound.volume = 0.5;
                sound.play().catch(error => {
                    console.error('Error al reproducir el sonido:', error);
                });
            }
        }
    }

    function updateCounter(tipo) {
        const contador = document.getElementById(`${tipo}sCount`);
        if (contador) {
            const currentCount = parseInt(contador.textContent) || 0;
            contador.textContent = (currentCount + 1).toString();
        }
    }

    // Escuchar actualizaciones del Socket.IO
    socket.on('update-dashboard', (data) => {
        console.log('Recibido evento:', data);
        
        if (data.tipo === 'cards-count') {
            const cardsCount = document.getElementById('cardsCount');
            if (cardsCount) {
                cardsCount.textContent = data.count;
            }
        }

        if (data.tipo === 'estado') {
            const statusCircle = document.querySelector('.status-circle');
            const startButton = document.getElementById('startButton');
            
            if (statusCircle && startButton) {
                if (checkerRunning || data.estado === 'stopping' || data.estado === 'stopped') {
                    statusCircle.textContent = data.mensaje;
                    startButton.textContent = data.mensaje;
                }
                
                if (data.estado === 'running') {
                    checkerRunning = true;
                    startButton.classList.add('running');
                    if (data.style) {
                        startButton.style.cssText = data.style;
                    } else {
                        startButton.style.cssText = 'font-size: 14px; color: white;';
                    }
                } else if (data.estado === 'stopping') {
                    startButton.textContent = '🛑 Deteniendo checker...';
                    startButton.disabled = true;
                    startButton.style.cssText = 'font-size: 16px; color: white;';
                } else if (data.estado === 'stopped') {
                    checkerRunning = false;
                    startButton.classList.remove('running');
                    startButton.textContent = '🔥 ¡Gate Cargado!';
                    startButton.disabled = false;
                    startButton.style.pointerEvents = 'auto';
                    startButton.style.cssText = 'font-size: 16px; color: white;';
                }
            }
        } else if (data.tipo === 'live' || data.tipo === 'dead') {
            updateCounter(data.tipo);
            addCardToList(data);
            updateProcessCount();
        }

        // Manejar alertas de captcha
        if (data.tipo === 'captcha') {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 0, 0, 0.9);
                padding: 20px;
                border-radius: 10px;
                z-index: 9999;
                color: white;
                text-align: center;
                box-shadow: 0 0 20px rgba(0,0,0,0.5);
                animation: fadeIn 0.3s;
            `;
            
            modal.innerHTML = `
                <h3 style="margin: 0 0 10px 0;">⚠️ ¡ALERTA!</h3>
                <p style="margin: 0 0 15px 0;">Se ha detectado un captcha.<br>
                Por favor cambia tu IP y reinicia el checker.</p>
                <button onclick="this.parentElement.remove()" 
                        style="background: #fff; 
                               color: #ff0000; 
                               border: none; 
                               padding: 8px 20px; 
                               border-radius: 5px; 
                               cursor: pointer;
                               font-weight: bold;">
                    Entendido
                </button>
            `;
            
            document.body.appendChild(modal);
            
            // Reproducir sonido de alerta si existe
            const alertSound = document.getElementById('alertSound');
            if (alertSound) {
                alertSound.play().catch(e => console.log('Error reproduciendo sonido:', e));
            }
        }
    });
});

// Verificación de BIN
const binCheckBtn = document.getElementById('checkBinBtn');
const binCheckInput = document.getElementById('binCheckInput');
const binResult = document.getElementById('binResult');

if (binCheckBtn && binCheckInput && binResult) {
    binCheckBtn.addEventListener('click', async () => {
        const bin = binCheckInput.value.trim();
        if (bin.length !== 6) {
            alert('Por favor, ingresa un BIN de 6 dígitos.');
            return;
        }
        
        binCheckBtn.disabled = true;
        binCheckBtn.textContent = 'Verificando...';
        binResult.textContent = 'Consultando información del BIN...';

        try {
            const response = await fetch(`/proxy-binlist/${bin}`);
            const data = await response.json();
            
            const formatText = (text = '', length = 14) => {
                text = text || 'N/A';
                return text.length > length ? text.substring(0, length - 3) + '...' : text.padEnd(length);
            };

            const result = `
╔═══════ BIN Info ═════╗
║ BIN: ${bin.padEnd(15)} ║
║ Marca: ${formatText(data.scheme, 13)} ║
║ Tipo: ${formatText(data.type, 14)} ║
║ Nivel: ${formatText(data.brand, 13)} ║
║ Banco: ${formatText(data.bank?.name, 13)} ║
║ País: ${formatText(data.country?.name, 13)} ║
╚═════════════════════╝`;

            binResult.textContent = result;
        } catch (error) {
            console.error('Error al verificar BIN:', error);
            binResult.textContent = 'Error al verificar el BIN';
        } finally {
            binCheckBtn.disabled = false;
            binCheckBtn.textContent = 'Verificar BIN';
        }
    });

    binCheckInput.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 6);
    });
}

// Modificar la función que envía las tarjetas
async function checkCards() {
    const gate = document.getElementById('gateSelector').value;
    const cards = document.getElementById('cardsInput').value;
    const key = document.getElementById('keyInput').value;
    
    try {
        const response = await fetch('/check', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                cards: cards.split('\n'),
                gate: gate,
                key: key
            })
        });
        
        const data = await response.json();
        // ... manejo de la respuesta
    } catch (error) {
        console.error('Error:', error);
        // ... manejo del error
    }
}

// Mostrar enlace admin con Ctrl + Alt + A
document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'a') {
        const adminLink = document.getElementById('adminLink');
        if (adminLink) {
            adminLink.style.display = adminLink.style.display === 'none' ? 'block' : 'none';
        }
    }
});

async function showLives() {
    try {
        const response = await fetch('/api/lives/history');
        const data = await response.json();
        
        if (data.success) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(20, 20, 30, 0.95);
                padding: 20px;
                border-radius: 12px;
                border: 1px solid #4a90e2;
                z-index: 1000;
                max-width: 800px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
            `;
            
            let content = `
                <h2 style="color: #4a90e2; text-align: center;">Historial de Lives</h2>
                <div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: #8B0000; color: #FFD700; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                        Cerrar
                    </button>
                </div>
            `;
            
            data.lives.forEach(live => {
                // Determinar el gate y su color
                const gateColor = live.gate === 'elegbagate' ? '#00C851' : '#00C851';
                const gateName = live.gate === 'elegbagate' ? 'Elegba Gate' : 'Oshun Gate';
                
                content += `
                    <div style="background: rgba(30, 30, 40, 0.95); padding: 15px; margin: 8px 0; border-radius: 8px; border-left: 3px solid #4a90e2;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-size: 16px; color: #00C851;">${live.cardNumber || ''}|${live.month || ''}|${live.year || ''}|${live.cvv || ''}</div>
                                <div style="font-size: 12px; color: #888;">
                                     ${new Date(live.createdAt).toLocaleString()}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: ${gateColor};">⭐ ${gateName}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// Función para actualizar el contador total de lives
async function updateTotalLives() {
    try {
        const response = await fetch('/api/lives/history');
        const data = await response.json();
        if (data.success) {
            document.getElementById('totalLivesCount').textContent = data.lives.length;
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// Actualizar el contador al cargar la página

async function startChecker() {
    try {
        const gateType = document.getElementById('gateSelector').value;
        const userId = localStorage.getItem('userId');
        
        if (!userId) {
            console.error('No hay usuario logueado');
            return;
        }
        
        const response = await fetch('/api/start-checker', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                gateType: gateType,
                userId: userId
            })
        });
        
        const data = await response.json();
        if (data.success) {
            localStorage.setItem('userId', data.userId);
            checkerRunning = true;
            startButton.textContent = 'Checker Ejecutándose';
            startButton.classList.add('running');
        } else {
            alert(data.message);
            checkerRunning = false;
            startButton.textContent = '¡Gate Cargado!';
            startButton.classList.remove('running');
        }
    } catch (error) {
        console.error('Error al iniciar el checker:', error);
        alert('Error al iniciar el checker');
    }
}

// Agregar la función de login si no existe
async function login() {
    try {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        const response = await fetch('/api/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                username,
                password
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Guardar el userId en localStorage cuando el login es exitoso
            localStorage.setItem('userId', data.userId);
            window.location.href = '/dashboard';  // o donde redirijas después del login
        } else {
            alert('Usuario o contraseña incorrectos');
        }
    } catch (error) {
        console.error('Error en login:', error);
        alert('Error al intentar iniciar sesión');
    }
}

function clearList(listId) {
    const list = document.getElementById(listId);
    if (list) {
        while (list.firstChild) {
            list.removeChild(list.firstChild);
        }
        
        // Actualizar contadores
        if (listId === 'livesList') {
            document.getElementById('livesCount').textContent = '0';
        } else if (listId === 'deadsList') {
            document.getElementById('deadsCount').textContent = '0';
        }
    }
}

// Contador de intentos para acceso admin
let adminAttempts = 0;
const MAX_ATTEMPTS = 3;
let lastAttemptTime = 0;
const LOCKOUT_TIME = 30 * 60 * 1000; // 30 minutos en milisegundos

// Atajo para panel de sistema (Ctrl+Shift+P)
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'p') {
        e.preventDefault();
        
        // Verificar si está bloqueado
        const now = Date.now();
        if (adminAttempts >= MAX_ATTEMPTS && (now - lastAttemptTime) < LOCKOUT_TIME) {
            const minutesLeft = Math.ceil((LOCKOUT_TIME - (now - lastAttemptTime)) / 60000);
            alert(`Acceso bloqueado por demasiados intentos fallidos.\nIntente nuevamente en ${minutesLeft} minutos.`);
            return;
        }
        
        // Resetear intentos si ha pasado el tiempo de bloqueo
        if ((now - lastAttemptTime) > LOCKOUT_TIME) {
            adminAttempts = 0;
        }
        
        const adminKey = prompt('🔐 Ingrese la clave de administrador:');
        
        if (adminKey === 'ALEMAN2024') {
            adminAttempts = 0; // Resetear intentos al acceder correctamente
            const systemWindow = window.open('/admin/system', 'SystemPanel', 
                'width=800,height=600,menubar=no,toolbar=no,location=no,status=no');
            if (systemWindow) {
                systemWindow.focus();
            } else {
                alert('Por favor permite las ventanas emergentes para acceder al panel de administración');
            }
        } else {
            adminAttempts++;
            lastAttemptTime = now;
            const attemptsLeft = MAX_ATTEMPTS - adminAttempts;
            
            if (attemptsLeft > 0) {
                alert(`Clave incorrecta. Le quedan ${attemptsLeft} intentos.`);
            } else {
                alert('Acceso bloqueado por demasiados intentos fallidos.\nIntente nuevamente en 30 minutos.');
            }
        }
    }
});

const killProcess = document.getElementById('killProcess');

if (killProcess) {
    killProcess.addEventListener('click', async () => {
        if (!confirm('¿MATAR TODOS LOS PROCESOS?')) return;
        
        try {
            // Deshabilitar el botón mientras se procesa
            killProcess.disabled = true;
            killProcess.textContent = '⏳ Matando...';
            
            // Matar todos los procesos
            const response = await fetch('/api/stop-checker', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            
            // Solo actualizar el estado si la respuesta fue exitosa
            if (response.ok) {
                checkerRunning = false;
                if (startButton) {
                    startButton.classList.remove('running');
                    startButton.textContent = '🔥 ¡Gate Cargado!';
                    startButton.disabled = false;
                }
                
                // Solo mostrar mensaje de éxito
                alert('🛑 Procesos terminados');
            }
            
        } catch (error) {
            console.error('Error en kill process:', error);
            alert('Error al matar procesos');
        } finally {
            // Restaurar el botón
            killProcess.disabled = false;
            killProcess.textContent = '🛑 Kill';
        }
    });
}

// Agregar al inicio del script existente
(function() {
    // Anti-debugging básico
    setInterval(() => {
        const start = performance.now();
        debugger;
        const end = performance.now();
        if (end - start > 100) {
            window.location.href = '/login.html';
        }
    }, 1000);

    // Deshabilitar teclas de desarrollo
    document.addEventListener('keydown', function(e) {
        if (
            e.key === 'F12' || 
            (e.ctrlKey && e.shiftKey && e.key === 'I') ||
            (e.ctrlKey && e.shiftKey && e.key === 'J') ||
            (e.ctrlKey && e.key === 'U')
        ) {
            e.preventDefault();
        }
    });
})();

let adminModeActive = false;

// Modificar el evento de teclas para el panel admin
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'p') {
        e.preventDefault();
        
        const adminKey = prompt('🔐 Ingrese la clave de administrador:');
        
        if (adminKey === 'ALEMAN2024') {
            adminModeActive = true; // Activar modo admin
            const systemWindow = window.open('/admin/system', 'SystemPanel', 
                'width=800,height=600,menubar=no,toolbar=no,location=no,status=no');
            if (systemWindow) {
                systemWindow.focus();
            } else {
                alert('Por favor permite las ventanas emergentes para acceder al panel de administración');
            }
        } else {
            alert('Clave incorrecta');
        }
    }
});

// Protección contra DevTools
(function() {
    // Deshabilitar clic derecho
    document.addEventListener('contextmenu', e => {
        if (!adminModeActive) {
            e.preventDefault();
        }
    });
    
    // Deshabilitar teclas de desarrollo
    document.addEventListener('keydown', function(e) {
        if (!adminModeActive && (
            e.key === 'F12' || 
            (e.ctrlKey && e.shiftKey && e.key === 'I') ||
            (e.ctrlKey && e.shiftKey && e.key === 'J') ||
            (e.ctrlKey && e.key === 'U')
        )) {
            e.preventDefault();
            alert('⚠️ Acceso denegado');
        }
    });

    // Anti-debugging
    setInterval(() => {
        if (!adminModeActive) {
            const start = performance.now();
            debugger;
            const end = performance.now();
            if (end - start > 100) {
                window.location.href = '/login.html';
            }
        }
    }, 1000);

    // Detectar apertura de DevTools por cambio de tamaño
    let devtoolsOpen = false;
    const threshold = 160;

    const checkDevTools = () => {
        if (!adminModeActive) {
            const widthThreshold = window.outerWidth - window.innerWidth > threshold;
            const heightThreshold = window.outerHeight - window.innerHeight > threshold;
            
            if ((!devtoolsOpen && (widthThreshold || heightThreshold))) {
                devtoolsOpen = true;
                alert('⚠️ DevTools no permitido');
                window.location.href = '/login.html';
            }
        }
    };

    window.addEventListener('resize', checkDevTools);
    setInterval(checkDevTools, 1000);
})();

// Agregar al inicio del script, después de la declaración de adminModeActive
window.addEventListener('message', function(event) {
    if (event.data.type === 'toggleDevTools') {
        // Verificar que el mensaje incluye la clave admin correcta
        if (event.data.adminKey === 'ALEMAN2024') {
            adminModeActive = event.data.enabled;
            
            if (adminModeActive) {
                console.log('🛠️ DevTools habilitado por admin');
                // Desactivar todas las protecciones de DevTools
                window.removeEventListener('keydown', blockDevTools);
                window.removeEventListener('contextmenu', blockRightClick);
                clearInterval(debuggerInterval);
            } else {
                console.log('🔒 DevTools deshabilitado');
                // Reactivar protecciones
                window.addEventListener('keydown', blockDevTools);
                window.addEventListener('contextmenu', blockRightClick);
                setupDebuggerProtection();
            }
        }
    }
});

// Función para reactivar protecciones
function setupDebuggerProtection() {
    debuggerInterval = setInterval(() => {
        if (!adminModeActive) {
            const start = performance.now();
            debugger;
            const end = performance.now();
            if (end - start > 100) {
                window.location.href = '/login.html';
            }
        }
    }, 1000);
}

// Funciones de bloqueo
function blockDevTools(e) {
    if (!adminModeActive && (
        e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
        (e.ctrlKey && e.shiftKey && e.key === 'J') ||
        (e.ctrlKey && e.key === 'U')
    )) {
        e.preventDefault();
        alert('⚠️ Acceso denegado');
    }
}

function blockRightClick(e) {
    if (!adminModeActive) {
        e.preventDefault();
    }
}
</script>
    <audio id="liveSound" preload="auto">
        <source src="chucky-new.mp3" type="audio/mp3">
        Tu navegador no soporta el elemento de audio.
    </audio>
    <audio id="alertSound" preload="auto">
        <source src="alert.mp3" type="audio/mp3">
    </audio>
</body>
</html>